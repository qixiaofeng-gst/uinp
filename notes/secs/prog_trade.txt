过去十五年，我曾有幸遇到过三位勤奋的股市研究者。每人都很用功，很刻苦，但很不幸却都走了弯路。

【故事】

第一位是中年人，1997年的时候来找我，带着一书包的研究资料，希望与我交流切磋一下。
打开书包，厚厚一叠资料，全是密密麻麻手写的小字，还有一张 张图表，全是手工画的趋势线和波浪线。
看得出，几年辛苦，期望几分香甜。可惜，那时候我早已转向基本分析，对波浪之类的东西没什么兴趣，只能劝回。

2002年，一位南方的小伙子带着三大本书稿远道而来，希望我做一下评判、写个序言。
打开书稿，让人有点头疼，竟然是与股市实战相关的纯K线战法研究。
彼时，我沉醉于量化投资研究，而国内证券市场正在兴起数学金融，K线之类的东西未免太落伍了吧。

虽然透过书稿，能看到他的认真和辛苦，但我也只能婉拒了。
不过，他是幸运的，两年后，三本书都出版了，据说卖得还不错。
再后来，他也小有名气了，还创办了一家私募投资公司，只是私募产品的业绩欠佳而已。

后来，一位西部的年轻人又慕名而来，他带来的是笔记本电脑里的程序化交易系统，在上海滩闯荡许久，却未见成果，希望我给鉴定和评判一下。
此时，程序化交易正在中国证券界大行其道，看起来还是一个很前沿的课题。

只是，见面后，我多少有点失望。
他使用的是市面常见的交易软件，编写的是相对简单的东西，但问其原理，他却三缄其口，显然顾忌到自己的知识产权问题。
抛开细节询问，才知道用的是类似于均线战法的东西，理论未见创新，程序未见突出，回报率不高，回撤率却太高。

拒绝人是困难的。
我询问了一下他的个人情况，
    原以为只是二十多岁的小青年，
    却不料早已读完研究生了，这位先后毕业于名牌大学数学系和计算机系的硕士，
    2007年曾经在股市大赚，随后就对市场一腔热情，
    竟然辞去在外企的工作，快四十岁的人了，还暂缓与女友结婚，
    一门心思钻入金融研究领域，力图搞出点名堂来。
但积蓄用完，却找不到在市场的容身之地，只得讪讪而回。

这么多年股市的低迷，多少优秀青年，将大好韶光浪费在股市中，疲于奔命却难以赚钱，耗费了青春更耗费了金钱，让人叹惋。
对于不是科班毕业于金融领域的年轻人来说，如果在股市中找不到合适的方向，切不可贸然丢掉原来的饭碗转战股市。
而一众醉心于股市研究的人，更应该警醒，如果不能选准方向，则研究越深，伤人越深！

最近流行于中国金融市场的程序化交易的研究，也存在类似的问题。

程序化交易，说简单点，就是让电脑执行研究、分析、决策、交易的投资全过程。
选什么品种，是买还是卖还是对冲，数量多少，持仓时间长短，止损止盈与否等等，都不再有人的主观参与，而是完全把设计好的程序交给计算机去执行。

看起来，人隐在背后，机器唱主角，但机器毕竟听命于程序，而程序是人设计的，所以，从本质来说，这是一种人机对话的模式。

程序化交易最早被对冲基金使用。

1950年代，美国市场才诞生了第一只对冲基金，随后几十年，美国市场的对冲基金越来越多，量化投资登上舞台，随着计算机技术的发展，程序化交易逐渐成为对冲基金的主流。

2008年，全球金融市场崩溃，但依靠数量化投资的大奖章基金获得了逾80%的费后收益率而傲视群侪，它的创立者西蒙斯更创下了持续20年年化超过60%的收益率，将股神巴菲特远远甩在身后。

至此，新的神话出炉，西蒙斯成为程序化交易者崇拜的新偶像。

最近几年，中国证券市场萎靡不振，无论多么牛的投资者，都在市场面前进退维谷，而依靠数量化投资的一些准对冲基金则开始崭露头角，程序化交易由此进入中国金融市场，并有日益燎原之势。

相关的讲座、座谈会、交流会接踵而至，美好的前景似乎就在不远的将来：美国市场有超过2万亿美元的资金专事程序化交易，一些主要市场的近五成交易量来自机器下单，而中国的市场，尚属空白，潜力巨大。

事实上，程序化交易在此时走入中国，离不开市场发展的背景。
目前，中国内地股市正在交易的股票近2600只，债券和基金也上千只，纯粹依靠人的主观分析和研究，已经很难获得有效成果。

五年前，市场还有一批研究者每天研究上市公司公告，并可不时发掘一些投资机会。
但如今，季报披露与年报和中报重叠，要在三四个月内看完五千多份公司定期报告，根本是不可能完成的任务。
程序化研究和选股是势在必然。这为中国未来的程序化交易的发展奠定了基础。

但程序化交易在中国虽然说前景无限好，只是市场自身的阴霾，却给这个新兴的工具平添了一些障碍。

首先，欧美市场的股票是T+0交易，为像西蒙斯这样的数学高手创造了高频乃至超高频交易的舞台，他们可以抓住市场的瞬时变化，在毫秒级的运算中捕捉住稍纵即逝的交易机会——而这种交易，是包括了买和卖的超短线交易的。
中国股市人为设置的T+1交易，就此熄灭了所有超短线交易者的梦想火焰。

其次，对冲基金的核心是买卖同时进行，消除系统性风险，赚取市场偏差的可能利润，所以，他们必须同时建立多头和空头的仓位。

在欧美市场，这是不成问题的，但中国股市天然地只能做多，却一下子堵住了所有通向套利交易的大门。
最近两年，融资融券交易才姗姗来迟，但融券数量少得可怜，即便将来转融通能实行，融券的数量可以增加，却也不能简单卖空。

问题远不止如此。在美国，对冲基金融资融券的成本最低可以到年息0.5%，这使得对冲基金的资金和股票使用成本极低。
但在中国，融资融券的综合年成本超过10%！在一个波澜不惊的市场里，这几乎让套利者寸步难行。

当看到这些拦路虎的时候，程序化交易者却仍信心百倍：股市不行，可以转战期货市场。
没错，如果说程序化交易要在中国蓬勃发展，目前唯一的出路是期货市场。

但中国的期货市场规模虽然已经达到2000亿元，却仍显得容量太少，不适合数百亿资金的基金行事，这将制约对冲基金的发展规模。
相比之下，美国的外汇交易市场日均交易量就超过3万亿美元（而中国目前还没有发达的外汇市场），各种债券的日交易量超过1万亿美元。

就算可以从事期货的程序化交易，中国市场的另一个天然屏障是交易费用的高昂。

国外一些对冲基金实施的超高频交易，每天可以有数万乃至几十万笔交易，靠的是低廉的交易佣金（比如佣金包干制等），而国内所有交易所的收费都是天文数字。
如果在中国期货市场从事高频交易，无非是给交易所和经纪商打工而已，谈何赚钱！

当然，对于有心人、聪明人来说，这一切，也许都不是问题。市场的机会就摆在那里，未免让高手心痒难耐。
所以，中国的程序化交易已经起步了。只是，远景灿烂，不意味着这口饭好吃。最重要的是，如何打开程序化交易的“黑箱”呢？

对每一个意欲在这个领域深入发展的人来说，首先都要问一下：没日没夜地辛苦工作、钻研、编程，会不会南辕北辙？
你的“黑箱”里准备装点啥进去呢？会不会像本文开头提到的三位研究者一样，播下的是龙种，收获的是跳蚤呢？

貌似神秘的“黑箱”其实不黑，里面存在的逻辑也一目了然。
期指交易者主要还是散户，有着浓重的做多情结，对后市永远看好，在他们看来，一个月后才到期的期指合约，出现1%的溢价是可以接受的。
他们对后市的预期，给程序化交易者基本无风险坐收渔利的机会。

套利交易，往往意味着较低的利润率和较小的风险，是程序化交易者所喜爱的。
不过，最近一段时间，有家机构在募集资金，准备从事期限套保（做多股票而做空期指），追求的目标回报率是每年100%，颇让不少投资者惊叹。

细究之下，实现目标也不难。此前，上海一家机构实战一年多，期限套保的年收益是15%，而最大的资金回撤幅度还不到2%。
在资金走势图上，是比较标准的倾斜向上的准直线。
而今，类似方式怎么可能达到年化一倍的收益率呢？

是杠杆的作用。

这家机构准备募集9000万元优先资金，许诺给予5%的固定回报；另外募集1000万元劣后资金，要承担固定回报和可能的风险。
这样，1亿元总资金预期年收益1500万元，扣除优先级的500万元回报，剩下1000万利润就全归劣后资金所有，年化正是100%。

杠杆资金，放大了承担风险者的收益，这或许正是西蒙斯的基金可以每年保持50%以上回报的原因。
事实上，巴菲特、索罗斯都是靠放大的资金做到高回报的。
在资金成本低廉的美国，很多资金的年成本往往不到1%，给稳健的投资者提供了施展身手的舞台。

如果国内的资金成本能降低到5%以下，交易成本也能在现有水平降低一半以上，则中国的程序化交易才会有更大的市场。

话题转回上述套利模式。他们程序化交易里的“黑箱”是什么呢？很简单，买进沪深300成份股并持有，然后，在股指期货出现升水1%上下的时候做空期指。

由于期指新合约往往比沪深300指数高1%左右（主要是时间价值所致），而在期指交割日，升水必然会到0，这就给套利者提供了机会。
只要每月能稳赚这升水下降的利润，年化收益率就有13%。在股票分红季（每年3月~7月），期指升水会下降，但套利者还可以获得股票分红的收益。
再加上捕捉一些瞬间的期指高升水过程，实现每年15%的收益并不难。

所以，貌似神秘的“黑箱”其实不黑，里面存在的逻辑也一目了然。
更重要的是，这种盈利模式符合当前的市场行为——期指交易者主要还是散户，有着浓重的做多情结，对后市永远看好，在他们看来，一个月后才到期的期指合约，出现1%的溢价是可以接受的。
他们对后市的预期，给程序化交易者基本无风险坐收渔利的机会。

当然，如果类似交易模式越来越多，在套利资金重压下，期指的升水幅度将越来越小，套利者实现年化10%的收益都将变得困难，这种盈利模式也将逐渐失去吸引力。

对一些初涉程序化交易的人来说，这种套利模式太过“小儿科”。他们要追求的是年收益30%以上甚至100%以上的盈利模式。

在编程测验阶段，他们经常能找到一些资产净值会像飘带一样上扬的模型，胜率甚至会达到90%以上。
但如果将这个模型纳入实战，却并不尽如人意。
此时检查模型，却发现原来是程序编制出现了差错的类似情况，往往是把事后发生的交易看作是事前行为。

比如，假如今日收阳线，则买进，收阴线则卖出。买卖点应该是收盘价，很多新手却设置成开盘价。
这一点差错，会导致检验结果与实战效果大相径庭。

很多人会把过去实战中的经验带进程序化里来。

比如，有一位专门从事涨停板交易的高手，今年前10个月的利润率就超过70%。
他也有自己的一整套追涨停板的思路，但将这些思路量化成程序后，却发现胜率极低——只有不到四成的交易是盈利的，而且收益率也并不高。

此时回去查验过去的交易记录，才发现盈利主要出现在股市上涨阶段。
当股市上涨的时候，他买进当日封涨停的股票，随后几天卖出，胜率很高——问题是此时其他股票也多数在上涨。
当市场下跌的时候，他交易频率降低，亏损也很小，这样确保了整体利润较高。但这样的思路如何实现编程，需要费点心思。

还有人喜欢把技术指标纳入程序化交易中。

市面上常见的技术指标，用起来省事，不用太费脑筋，但效果却不佳。
趋势跟随系统，包括通道、均线、KD、MACD 等等，尽管是即时模型，却也经常滞后，难以准确捕捉到市况的转折，更重要的是，在市场趋势不明朗的时候，频繁的交易会损耗掉绝大多数此前的利润。

比如，有人用60日均线来做沪铜的交易，简单测算一下，历史收益率可以达到数十倍。
但放到程序中呢？有无数次在均线上下翻飞的交易，整体测算的利润就十分有限了。
有人不服气：我可以人工判断是否有效上穿或下穿均线，这样可以降低无效交易，提高胜率。
遗憾的是，无数人正是因为人工判断失败才想到了程序化之路。

可见，程序化交易的黑箱里放什么“货”是最重要的。
每个人都可以有自己的思路，但无论什么思路，如果要想通过系统的检验，就得首先通过行为理论的检验：这样一个模型，反映了怎样的市场行为，而这种行为又符合怎样的人性理论。

如果能通过行为检验，知道模型背后体现的人性，则这样的系统就会长期稳定地带来盈利。
否则，就算它检验结果再好，也无法持久有效。

此外，模型检验过程中，还会遇到“虚假繁荣”的情况。

笔者此前曾测试过多个模型，年化收益率都在3倍以上。但回撤的幅度不理想。

比如，1手螺纹钢，一年可以赚1.5万元，对应着3倍的收益率，看起来很好。不过，回撤（从任意市值最高点回落的幅度）有点大，达到4000元。

外行人一看，会觉得盈亏比率是满意的，这种风险可以承受。只是，螺纹钢1手所需要的交易保证金还不到4000元。
这种回撤，意味着一笔交易可能把本金赔光——其实不用等你赔光，早已被强制平仓了。

一种模型如果被装进“黑箱”用于实战，我们永远不知道它会首先带来利润还是亏损。
如果不幸该模型正好进入调整期，本金先赔光再带来利润，又有什么用呢？

另一种趋势模型，会带来较多利润，但胜率很低，只有三四成。
这样的模型，一旦进入实战，难免首先持续较长时间的盈亏平衡略有亏损，很多人耐不住寂寞而弃之用。
但人工一旦干预，效果还不如机器操作。

而且还会发现，越是频繁亏损的时候，随后越能带来利润。
所以，程序化交易模式一旦确立，是要有一些耐心来听机器带来结果的。
胜率不是最主要的，利润才是根本。

有没有胜率高且回报率也高的程序呢？

也有的。笔者此前测试的一个模型，胜率会达到100%，而且能经得起检验，年化收益率会达到3倍。
看起来很美，只是利润需要煎熬，有时候已经出现了20%的利润，却还会有较大的回调乃至于出现了15%的亏损。
如果不止损，最后还是能有30%的利润。这样大幅度的回撤，你是否有承受的勇气呢？

更何况，如果这笔交易最终亏损20%平仓，下一笔交易还是出现了20%的亏损，此时，你是否还有勇气坚持这个模型呢？
此时，它考验的是你的智慧。

所以，程序化交易的黑箱，并不是不可泄露的天机。
它体现的是交易者的智慧。

编制一个交易的模型不难，通过检验也不难，难的是执行者的决断。
在很多情况下，执行者的决断远比智慧更重要。
而如果一个人有足够的智慧又有恰如其分的决断力，有没有程序化交易的东西，反而并不重要了。

微信公众号 大宽客：专注算法交易，分享算法/量化交易的技术和头条。
我们即将上线机器学习算法交易平台，关注公众号，获取内测邀请，并有机会获得永久VIP服务。
